#!/usr/bin/env ruby

def parse(text='')
  text.gsub!(%r{"/\*>\s*(.+?)\s*\*/"}) {
    "'" << parse(File.read($1)).gsub(%r{$}, '\\').chop << "'"
  }
  text.gsub!(%r{/\*>\s*(.+?)\s*\*/}) {
    parse(File.read($1))
  }
  text
end

unless ARGV.empty?
  ARGV.each do |a|
    puts parse(File.read(a))
  end
end

if STDIN.stat.size > 0
  puts parse(STDIN.read)
end
