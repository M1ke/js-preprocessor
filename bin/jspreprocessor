#!/usr/bin/env ruby

def parse(text='')
  text.gsub!(%r{"/\*>\s*(.+?)\s*\*/"}) {
    "'" << File.read($1).gsub(%r{$}, '\\').chop << "'"
  }
  text.gsub!(%r{/\*>\s*(.+?)\s*\*/}) {
    File.read($1)
  }
  puts text
end

unless ARGV.empty?
  ARGV.each do |a|
    parse(File.read(a))
  end
end

if STDIN.stat.size > 0
  parse(STDIN.read)
end
