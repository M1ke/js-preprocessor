#!/usr/bin/env ruby

$dir = File.dirname ARGV.first || '.'

def parse(text='')
  text.gsub!(%r{"/\*>\s*(.+?)\s*\*/"}) {
    '"' << parse(File.read File.join($dir, $1)).gsub(%r{$}, '\\').chop << '"'
  }
  text.gsub!(%r{/\*>\s*(.+?)\s*\*/}) {
    parse(File.read File.join($dir, $1))
  }
  text
end

if not ARGV.empty?
  ARGV.each do |a|
    puts parse File.read a
  end
elsif STDIN.stat.size > 0
  puts parse STDIN.read
end
